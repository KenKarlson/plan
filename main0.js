// === –î–∞–Ω–Ω—ã–µ ===
const plans = {
  htmlcss: {
    title: "HTML & CSS",
    weeks: [
      {
        number: 1,
        title: "–ù–µ–¥–µ–ª—è 1",
        description: "–û—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã —Å HTML –∏ –Ω–∞—á–∞–ª–æ –≤–µ—Ä—Å—Ç–∫–∏.",
        topics: [
          {
            day: 1,
            theme: "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Web",
            task: "–ò–∑—É—á–∏—Ç—å –æ—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞",
            questions: [
              {
                q: "1. –í–≤–µ–¥–µ–Ω–∏–µ",
                desc: "–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –≤–µ–± –∏ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.",
                example: "http://example.com",
              },
            ],
          },
          {
            day: 2,
            theme: "–ß—Ç–æ —Ç–∞–∫–æ–µ HTML & CSS",
            task: "–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —è–∑—ã–∫–∞–º–∏ —Ä–∞–∑–º–µ—Ç–∫–∏ –∏ —Å—Ç–∏–ª–µ–π",
            questions: [
              {
                q: "1. –í–≤–µ–¥–µ–Ω–∏–µ",
                desc: "HTML ‚Äî —è–∑—ã–∫ —Ä–∞–∑–º–µ—Ç–∫–∏, CSS ‚Äî —Å—Ç–∏–ª—å.",
                example: "<p>–¢–µ–∫—Å—Ç</p>",
              },
            ],
          },
        ],
      },
      {
        number: 2,
        title: "–ù–µ–¥–µ–ª—è 2",
        description: "–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Å–∞–π—Ç–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –µ–≥–æ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ.",
        topics: [
          {
            day: 3,
            theme: "–û—Å–Ω–æ–≤—ã –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å",
            task: "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞",
            questions: [
              {
                q: "1. –ë–∞–∑–æ–≤—ã–µ —Ç–µ–≥–∏",
                desc: "–¢–µ–≥–∏ <html>, <head>, <body>",
                example:
                  "<html><head><title>Page</title></head><body></body></html>",
              },
            ],
          },
          {
            day: 4,
            theme: "–¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä VSCode",
            task: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –±–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ",
            questions: [
              {
                q: "1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞",
                desc: "–°–∫–∞—á–∏–≤–∞–µ–º —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞",
                example: "",
              },
            ],
          },
        ],
      },
    ],
  },
  js: {
    title: "JavaScript",
    weeks: [
      {
        number: 1,
        title: "–ù–µ–¥–µ–ª—è 1",
        description: "–í–≤–µ–¥–µ–Ω–∏–µ –≤ JavaScript. –û—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.",
        topics: [
          {
            day: 1,
            theme: "Hello World",
            task: "–ü–µ—Ä–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–∞ JS",
            questions: [
              {
                q: "1. –í—ã–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞",
                desc: "–ò—Å–ø–æ–ª—å–∑—É–µ–º console.log()",
                example: "console.log('Hello World');",
              },
            ],
          },
        ],
      },
    ],
  },
  git: {
    title: "Git",
    weeks: [],
  },
  react: {
    title: "React",
    weeks: [],
  },
  practice: {
    title: "–ü—Ä–∞–∫—Ç–∏–∫–∞ React",
    weeks: [],
  },
  backend: {
    title: "Backend",
    weeks: [],
  },
  ts: {
    title: "TypeScript",
    weeks: [],
  },
};

let currentModule = "htmlcss";
let savedProgress = {};
const progressKeyPrefix = "progress-";

// === DOM —ç–ª–µ–º–µ–Ω—Ç—ã ===
const moduleButtons = document.querySelectorAll("#module-buttons button");
const contentContainer = document.getElementById("content");
const progressBarFill = document.getElementById("progress-fill");
const completedCountEl = document.getElementById("completed-count");
const totalCountEl = document.getElementById("total-count");
const progressPercentEl = document.getElementById("progress-percent");

// === –§—É–Ω–∫—Ü–∏–∏ ===

function loadProgress() {
  const key = `${progressKeyPrefix}${currentModule}`;
  savedProgress = JSON.parse(localStorage.getItem(key)) || {};
}

function saveProgress() {
  const key = `${progressKeyPrefix}${currentModule}`;
  localStorage.setItem(key, JSON.stringify(savedProgress));
}

function updateProgress(total, completed) {
  const percent = Math.round((completed / total) * 100);
  progressBarFill.style.width = `${percent}%`;
  completedCountEl.textContent = completed;
  totalCountEl.textContent = total;
  progressPercentEl.textContent = `${percent}%`;
}

function renderModule(moduleKey) {
  currentModule = moduleKey;
  loadProgress();

  const plan = plans[moduleKey];
  if (!plan) return;

  let allQuestions = [];
  let totalQuestions = 0;

  contentContainer.innerHTML = "";

  plan.weeks.forEach((week) => {
    const weekEl = document.createElement("div");
    weekEl.className = "week";
    weekEl.innerHTML = `<h3>üìÖ –ù–µ–¥–µ–ª—è ${week.number}: ${week.title}</h3>`;
    if (week.description) {
      const desc = document.createElement("p");
      desc.className = "description";
      desc.textContent = week.description;
      weekEl.appendChild(desc);
    }

    week.topics.forEach((topic) => {
      const topicEl = document.createElement("div");
      topicEl.className = "topic";
      topicEl.innerHTML = `<h4>üìò –¢–µ–º–∞: ${topic.theme}</h4>`;
      if (topic.task) {
        const desc = document.createElement("p");
        desc.className = "description";
        desc.textContent = topic.task;
        topicEl.appendChild(desc);
      }

      const questionsList = document.createElement("ul");
      questionsList.className = "questions";

      topic.questions.forEach((q) => {
        const li = document.createElement("li");
        const label = document.createElement("span");
        label.textContent = q.q;

        // –ß–µ–∫–±–æ–∫—Å
        const checkboxWrapper = document.createElement("div");
        checkboxWrapper.className = "checkbox-wrapper";
        checkboxWrapper.innerHTML = `
          <label>
            <input type="checkbox" data-day="${topic.day}" ${
          savedProgress[topic.day] ? "checked" : ""
        } />
            –í—ã–ø–æ–ª–Ω–µ–Ω–æ
          </label>
        `;

        // –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
        const details = document.createElement("div");
        details.className = "question-details";
        details.innerHTML = `<p>${q.desc}</p><code>${q.example}</code>`;

        li.appendChild(label);
        li.appendChild(checkboxWrapper);
        li.appendChild(details);

        li.addEventListener("click", (e) => {
          if (e.target.type !== "checkbox") {
            details.classList.toggle("show");
          }
        });

        questionsList.appendChild(li);
        allQuestions.push({ el: li, day: topic.day });
      });

      topicEl.appendChild(questionsList);
      weekEl.appendChild(topicEl);
      totalQuestions++;
    });

    contentContainer.appendChild(weekEl);
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
  contentContainer
    .querySelectorAll("input[type='checkbox']")
    .forEach((input) => {
      input.addEventListener("change", (e) => {
        const day = e.target.closest("li").querySelector("[data-day]")
          .dataset.day;
        savedProgress[day] = e.target.checked;
        saveProgress();
        updateStats(allQuestions);
      });
    });

  updateStats(allQuestions);
}

function updateStats(allQuestions) {
  const total = allQuestions.length;
  const completed = allQuestions.filter((q) => savedProgress[q.day]).length;
  updateProgress(total, completed);
}

// === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
window.addEventListener("DOMContentLoaded", () => {
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
  moduleButtons.forEach((button) => {
    button.addEventListener("click", (e) => {
      moduleButtons.forEach((b) => b.classList.remove("active"));
      e.target.classList.add("active");
      renderModule(e.target.dataset.module);
    });
  });

  // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
  renderModule(currentModule);
});
